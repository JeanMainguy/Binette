Bootstrap: docker
From: condaforge/mambaforge
IncludeCmd: yes

%files
binette_dev.yaml /

%post
# build-essential g++ are needed to pip install checkm2
apt-get update && apt-get install -y procps build-essential g++ && apt-get clean -y
/opt/conda/bin/mamba env create -n binette -f /binette_dev.yaml && /opt/conda/bin/conda clean -a

export PATH=/opt/conda/envs/binette/bin:$PATH

# /opt/conda/bin/conda activate binette 

# get the archive
wget https://github.com/chklovski/CheckM2/archive/refs/tags/1.0.1.tar.gz

# decompress
tar -xf 1.0.1.tar.gz
rm 1.0.1.tar.gz

# install
pip install CheckM2-1.0.1/

checkm2 database --download --path checkm2/database/

git clone https://github.com/genotoul-bioinfo/Binette
pip install Binette/

binette -h


%environment
export PATH=/opt/conda/envs/binette/bin:$PATH

%runscript
     "$@"
